<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pawtektado - Pet Care Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Lighter gray background */
            color: #374151; /* Default text color: gray-700 */
        }
        .tab-button {
            transition: all 0.3s ease;
            border-bottom-width: 3px;
            border-color: transparent;
        }
        .tab-button.active {
            border-color: #3b82f6; /* Blue-500 */
            color: #3b82f6;
            /* background-color: #eff6ff; */ /* Removed background for a cleaner look */
        }
        .tab-button:hover {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
        }
        .card {
            background-color: white;
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 4px 12px -1px rgba(0, 0, 0, 0.07), 0 2px 8px -1px rgba(0, 0, 0, 0.04);
            transition: box-shadow 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 10px 20px -3px rgba(0, 0, 0, 0.07), 0 4px 10px -2px rgba(0, 0, 0, 0.04);
        }
        .modal {
            display: none; /* Hidden by default */
        }
        .modal.show {
            display: flex; /* Show when active */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e5e7eb; /* gray-200 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af; /* gray-400 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 */
        }
        .list-item {
            background-color: #f9fafb; /* gray-50 */
            padding: 1rem 1.25rem; 
            border-radius: 0.5rem; /* rounded-md */
            border: 1px solid #e5e7eb; /* border-gray-200 */
            transition: background-color 0.2s ease;
        }
        .list-item:hover {
            background-color: #f3f4f6; /* gray-100 */
        }
        .icon-sm {
            width: 1.25rem; /* 20px */
            height: 1.25rem; /* 20px */
            margin-right: 0.5rem; /* 8px */
        }
        .icon-md {
            width: 1.5rem; /* 24px */
            height: 1.5rem; /* 24px */
            margin-right: 0.5rem; /* 8px */
        }
        .btn {
            padding: 0.625rem 1.25rem; /* 10px 20px */
            border-radius: 0.5rem; /* 8px */
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
        }
        .btn-primary {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb; /* blue-600 */
        }
        .btn-secondary {
            background-color: #e5e7eb; /* gray-200 */
            color: #374151; /* gray-700 */
        }
        .btn-secondary:hover {
            background-color: #d1d5db; /* gray-300 */
        }
        .btn-danger {
            background-color: #ef4444; /* red-500 */
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626; /* red-600 */
        }
        .btn-success {
            background-color: #22c55e; /* green-500 */
            color: white;
        }
        .btn-success:hover {
            background-color: #16a34a; /* green-600 */
        }
        .input-field {
            margin-top: 0.25rem;
            display: block;
            width: 100%;
            padding: 0.625rem 0.75rem; /* 10px 12px */
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.5rem; /* 8px */
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: #3b82f6; /* blue-500 */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); /* blue-500 with opacity */
        }
        .empty-state-icon {
            width: 4rem; /* 64px */
            height: 4rem; /* 64px */
            color: #9ca3af; /* gray-400 */
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="text-gray-700">
    <div class="container mx-auto p-4 md:p-6 lg:p-8 max-w-5xl">
        <header class="text-center mb-10">
            <div class="inline-flex items-center justify-center bg-blue-500 p-3 rounded-full mb-4 shadow-lg">
                 <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7.5 14.5c0 .69.56 1.25 1.25 1.25h6.5c.69 0 1.25-.56 1.25-1.25S16.19 13.25 15.5 13.25h-6.5c-.69 0-1.25.56-1.25 1.25zM9 10.75s.5-1 1.5-1 1.5 1 1.5 1M13.5 10.75s.5-1 1.5-1 1.5 1 1.5 1"></path></svg>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-blue-600">Pawtektado</h1>
            <p class="text-gray-500 mt-3 text-lg">Your Pet Care Agent Manage needs, bookings, and history with ease.</p>
        </header>

        <nav class="mb-10 bg-white p-2 rounded-lg shadow-md">
            <div class="flex border-b border-gray-200 flex-wrap justify-center">
                <button id="tabMyPets" class="tab-button flex-1 py-3 px-2 md:px-4 text-sm md:text-base text-center font-semibold text-gray-500 hover:text-blue-500 focus:outline-none active inline-flex items-center justify-center" onclick="showSection('myPetsSection')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    My Pets
                </button>
                <button id="tabAddPet" class="tab-button flex-1 py-3 px-2 md:px-4 text-sm md:text-base text-center font-semibold text-gray-500 hover:text-blue-500 focus:outline-none inline-flex items-center justify-center" onclick="showSection('addPetSection')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Add Pet
                </button>
                <button id="tabBookings" class="tab-button flex-1 py-3 px-2 md:px-4 text-sm md:text-base text-center font-semibold text-gray-500 hover:text-blue-500 focus:outline-none inline-flex items-center justify-center" onclick="showSection('bookingsSection')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    Bookings
                </button>
                <button id="tabPetHistory" class="tab-button flex-1 py-3 px-2 md:px-4 text-sm md:text-base text-center font-semibold text-gray-500 hover:text-blue-500 focus:outline-none inline-flex items-center justify-center" onclick="showSection('petHistorySection')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Pet History
                </button>
                <button id="tabProviders" class="tab-button flex-1 py-3 px-2 md:px-4 text-sm md:text-base text-center font-semibold text-gray-500 hover:text-blue-500 focus:outline-none inline-flex items-center justify-center" onclick="showSection('providersSection')">
                     <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                    Providers
                </button>
            </div>
        </nav>

        <section id="myPetsSection" class="space-y-6">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">My Beloved Pets</h2>
            <div id="petsListContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
            <div id="noPetsMessage" class="text-center py-10 card hidden">
                <svg class="empty-state-icon mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>
                <p class="text-gray-500 text-lg">You haven't added any pets yet.</p>
                <button class="btn btn-primary mt-4" onclick="showSection('addPetSection')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    Add Your First Pet
                </button>
            </div>
        </section>

        <section id="addPetSection" class="hidden space-y-6 card p-6 md:p-8">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Introduce a New Friend</h2>
            <form id="addPetForm" class="space-y-6">
                <div>
                    <label for="petName" class="block text-sm font-medium text-gray-600">Pet's Name</label>
                    <input type="text" id="petName" name="petName" required class="input-field">
                </div>
                <div>
                    <label for="petBreed" class="block text-sm font-medium text-gray-600">Breed / Species</label>
                    <input type="text" id="petBreed" name="petBreed" required class="input-field">
                </div>
                <div>
                    <label for="petAge" class="block text-sm font-medium text-gray-600">Age (e.g., 2 years, 5 months)</label>
                    <input type="text" id="petAge" name="petAge" class="input-field">
                </div>
                <div>
                    <label for="petPhoto" class="block text-sm font-medium text-gray-600">Photo URL (Optional)</label>
                    <input type="url" id="petPhoto" name="petPhoto" placeholder="https://example.com/your-pet.jpg" class="input-field">
                </div>
                <button type="submit" class="btn btn-primary w-full">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    Add This Pet
                </button>
            </form>
        </section>

        <section id="petDetailsSection" class="hidden fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center p-4 z-50 modal backdrop-blur-sm">
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto card">
                <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-200">
                    <h2 id="detailsPetName" class="text-3xl font-bold text-blue-600"></h2>
                    <button onclick="closePetDetails()" class="text-gray-400 hover:text-gray-600 text-3xl transition-colors">&times;</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="md:col-span-1">
                        <img id="detailsPetPhoto" src="https://placehold.co/400x400/e2e8f0/94a3b8?text=Pet+Photo" alt="Pet Photo" class="rounded-lg object-cover w-full h-auto aspect-square mb-3 shadow-md">
                        <p class="text-gray-600"><strong class="text-gray-700">Breed:</strong> <span id="detailsPetBreed"></span></p>
                        <p class="text-gray-600"><strong class="text-gray-700">Age:</strong> <span id="detailsPetAge"></span></p>
                    </div>
                    <div class="md:col-span-2 space-y-4">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-3 flex items-center">
                                <svg class="icon-md text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
                                Needs & Reminders
                            </h3>
                            <div id="needsList" class="space-y-3 max-h-64 overflow-y-auto pr-2 bg-gray-50 p-3 rounded-lg border border-gray-200">
                                </div>
                            <p id="noNeedsMessage" class="text-gray-500 text-sm hidden p-4 text-center">No needs recorded yet. Add one below!</p>
                        </div>
                        <form id="addNeedForm" class="space-y-4 border-t border-gray-200 pt-4">
                            <input type="hidden" id="currentPetId">
                            <h4 class="text-lg font-semibold text-gray-700">Add New Need/Reminder</h4>
                            <div>
                                <label for="needDescription" class="block text-sm font-medium text-gray-600">Description (e.g., Vet Appointment, Vaccination)</label>
                                <input type="text" id="needDescription" required class="input-field">
                            </div>
                            <div>
                                <label for="needDate" class="block text-sm font-medium text-gray-600">Date & Time</label>
                                <input type="datetime-local" id="needDate" required class="input-field">
                            </div>
                             <div>
                                <label for="needProvider" class="block text-sm font-medium text-gray-600">Service Provider (Optional)</label>
                                <select id="needProvider" class="input-field">
                                    <option value="">None</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-success w-full">
                                <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                Add Need
                            </button>
                        </form>
                    </div>
                </div>
                 <button onclick="handleDeletePet()" id="deletePetButton" class="btn btn-danger w-full mt-4">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    Delete This Pet
                 </button>
            </div>
        </section>

        <section id="bookingsSection" class="hidden space-y-6">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Upcoming Bookings</h2>
            <div id="bookingsListContainer" class="space-y-4">
                </div>
            <div id="noBookingsMessage" class="text-center py-10 card hidden">
                <svg class="empty-state-icon mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                <p class="text-gray-500 text-lg">No current bookings found.</p>
            </div>
        </section>

        <section id="petHistorySection" class="hidden space-y-6">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Pet Care History</h2>
            <div id="petHistoryListContainer" class="space-y-4">
                </div>
            <div id="noHistoryMessage" class="text-center py-10 card hidden">
                 <svg class="empty-state-icon mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <p class="text-gray-500 text-lg">No pet history found yet.</p>
            </div>
        </section>

        <section id="providersSection" class="hidden space-y-6">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Find Service Providers</h2>
            <p class="text-sm text-gray-500 mb-6 -mt-4">Connect with local vets and pet service providers. (Sample Data)</p>
            <div id="providersListContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                </div>
        </section>

        <div id="messageModal" class="modal fixed inset-0 bg-gray-900 bg-opacity-60 items-center justify-center p-4 z-50 backdrop-blur-sm">
            <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md text-center card">
                <div id="messageModalIconContainer" class="mx-auto mb-4"></div>
                <p id="modalMessageText" class="text-lg text-gray-700 mb-6"></p>
                <button onclick="closeMessageModal()" class="btn btn-primary w-1/2">OK</button>
            </div>
        </div>
        
        <div id="confirmationModal" class="modal fixed inset-0 bg-gray-900 bg-opacity-60 items-center justify-center p-4 z-50 backdrop-blur-sm">
            <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md text-center card">
                <svg class="w-16 h-16 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                <p id="confirmationMessageText" class="text-lg text-gray-700 mb-6"></p>
                <div class="flex justify-center space-x-4">
                    <button id="confirmActionButton" class="btn btn-danger flex-1">Confirm</button>
                    <button id="cancelActionButton" class="btn btn-secondary flex-1">Cancel</button>
                </div>
            </div>
        </div>

    </div>

    <footer class="text-center py-10 mt-16 border-t border-gray-200 bg-white">
        <p class="text-gray-500 text-sm">&copy; <span id="currentYear"></span> Pawtektado. Happy Pets, Happy Life!</p>
        <p class="text-xs text-gray-400 mt-1">Crafted with ❤️ for our furry friends by Kevin Rhay Avendano</p>
    </footer>

    <script>
        // --- DOM Elements ---
        const sections = {
            myPets: document.getElementById('myPetsSection'),
            addPet: document.getElementById('addPetSection'),
            petDetails: document.getElementById('petDetailsSection'),
            providers: document.getElementById('providersSection'),
            bookings: document.getElementById('bookingsSection'),
            petHistory: document.getElementById('petHistorySection')
        };
        const tabs = {
            myPets: document.getElementById('tabMyPets'),
            addPet: document.getElementById('tabAddPet'),
            providers: document.getElementById('tabProviders'),
            bookings: document.getElementById('tabBookings'),
            petHistory: document.getElementById('tabPetHistory')
        };

        const addPetForm = document.getElementById('addPetForm');
        const petsListContainer = document.getElementById('petsListContainer');
        const noPetsMessage = document.getElementById('noPetsMessage');
        
        const detailsPetName = document.getElementById('detailsPetName');
        const detailsPetPhoto = document.getElementById('detailsPetPhoto');
        const detailsPetBreed = document.getElementById('detailsPetBreed');
        const detailsPetAge = document.getElementById('detailsPetAge');
        const needsList = document.getElementById('needsList');
        const noNeedsMessage = document.getElementById('noNeedsMessage');
        const addNeedForm = document.getElementById('addNeedForm');
        const currentPetIdInput = document.getElementById('currentPetId');
        const needProviderSelect = document.getElementById('needProvider');

        const providersListContainer = document.getElementById('providersListContainer');
        const bookingsListContainer = document.getElementById('bookingsListContainer');
        const noBookingsMessage = document.getElementById('noBookingsMessage');
        const petHistoryListContainer = document.getElementById('petHistoryListContainer');
        const noHistoryMessage = document.getElementById('noHistoryMessage');
        
        const messageModal = document.getElementById('messageModal');
        const modalMessageText = document.getElementById('modalMessageText');
        const messageModalIconContainer = document.getElementById('messageModalIconContainer');


        const confirmationModal = document.getElementById('confirmationModal');
        const confirmationMessageText = document.getElementById('confirmationMessageText');
        const confirmActionButton = document.getElementById('confirmActionButton');
        const cancelActionButton = document.getElementById('cancelActionButton');
        let currentConfirmAction = null;

        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // --- Data Storage (localStorage) ---
        let pets = [];
        let currentEditingPetId = null;

        // --- Sample Provider Data ---
        const serviceProviders = [
            { 
                id: 'vet1', 
                name: 'Happy Paws Veterinary Clinic', 
                type: 'Veterinarian', 
                phone: '555-0101', 
                email: 'contact@happypawsvet.example.com', 
                address: '123 Vet Street, Anytown',
                services: ['Checkups', 'Vaccinations', 'Surgery', 'Dental Care'],
                icon: '<svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M7.76 15.24A5.992 5.992 0 0112 14a5.992 5.992 0 014.24 1.24M12 3v2m0 14v2m-7.07-2.93l1.41-1.41M17.66 7.34l1.41-1.41M3 12h2m14 0h2M6.34 7.34l-1.41-1.41M19.07 16.66l-1.41-1.41"></path></svg>' // Simple representation
            },
            { 
                id: 'groomer1', 
                name: 'Pristine Pups Grooming', 
                type: 'Groomer', 
                phone: '555-0202', 
                email: 'info@pristinepups.example.com', 
                address: '456 Groomer Ave, Anytown',
                services: ['Bathing', 'Haircuts', 'Nail Trimming', 'De-shedding'],
                icon: '<svg class="w-8 h-8 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16v4m-2-2h4m2 13.5V21M16 19h4m0-13.5V5M16 7h4m-9 7a3 3 0 01-6 0 3 3 0 016 0zm12 0a3 3 0 01-6 0 3 3 0 016 0z"></path></svg>'
            },
            { 
                id: 'walker1', 
                name: 'Walky Paws Dog Walking', 
                type: 'Dog Walker', 
                phone: '555-0303', 
                email: 'bookings@walkypaws.example.com', 
                address: '789 Park Road, Anytown',
                services: ['Group Walks', 'Solo Walks', 'Pet Sitting (short)'],
                icon: '<svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.5 15a.5.5 0 01.5-.5h16a.5.5 0 010 1H4a.5.5 0 01-.5-.5zM17.5 10.5l-1.293 1.293a1 1 0 01-1.414 0L12 9.086l-2.793 2.707a1 1 0 01-1.414 0L6.5 10.5"></path></svg>'
            },
             { 
                id: 'vet2', 
                name: 'Healthy Tails Animal Hospital', 
                type: 'Veterinarian', 
                phone: '555-0105', 
                email: 'reception@healthytails.example.com', 
                address: '321 Health Blvd, Anytown',
                services: ['Emergency Care', 'Diagnostics', 'Wellness Exams', 'Nutrition Counseling'],
                icon: '<svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M7.76 15.24A5.992 5.992 0 0112 14a5.992 5.992 0 014.24 1.24M12 3v2m0 14v2m-7.07-2.93l1.41-1.41M17.66 7.34l1.41-1.41M3 12h2m14 0h2M6.34 7.34l-1.41-1.41M19.07 16.66l-1.41-1.41"></path></svg>'
            }
        ];
        
        // --- Sample Pet Data (if localStorage is empty) ---
        const samplePets = [
            {
                id: 'pet_sample1_bantay',
                name: 'Bantay',
                breed: 'Aspin (Philippine Native Dog)',
                age: '3 years',
                photo: 'https://placedog.net/400/400?id=55', // More specific dog placeholder
                needs: [
                    { id: 'need_sample1_1', description: 'Annual Checkup', date: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString().slice(0,16), providerId: 'vet1', status: 'Confirmed' },
                    { id: 'need_sample1_2', description: 'Grooming Session', date: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().slice(0,16), providerId: 'groomer1', status: 'Pending' },
                    { id: 'need_sample1_3', description: 'Rabies Vaccination', date: new Date(Date.now() - 60 * 24 * 60 * 60 * 1000).toISOString().slice(0,16), providerId: 'vet1', status: 'Completed' }
                ]
            },
            {
                id: 'pet_sample2_muning',
                name: 'Muning',
                breed: 'Puspin (Philippine Shorthair Cat)',
                age: '1 year 6 months',
                photo: 'https://placekitten.com/400/400?image=12', // More specific cat placeholder
                needs: [
                    { id: 'need_sample2_1', description: 'Vaccination Booster', date: new Date(Date.now() + 45 * 24 * 60 * 60 * 1000).toISOString().slice(0,16), providerId: 'vet2', status: 'Confirmed' },
                    { id: 'need_sample2_2', description: 'Deworming', date: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString().slice(0,16), providerId: 'vet2', status: 'Completed' }
                ]
            }
        ];


        // --- Functions ---

        function showSection(sectionId) {
            Object.values(sections).forEach(section => section.classList.add('hidden'));
            Object.values(tabs).forEach(tab => tab.classList.remove('active'));
            
            const targetSection = sections[sectionId] || document.getElementById(sectionId);
            const targetTab = tabs[sectionId];

            if (targetSection) {
                targetSection.classList.remove('hidden');
                if (sectionId === 'petDetailsSection') {
                    targetSection.classList.add('show');
                }
            }
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            if (sectionId !== 'petDetailsSection' && sections.petDetails.classList.contains('show')) {
                sections.petDetails.classList.remove('show');
                sections.petDetails.classList.add('hidden');
            }
        }
        
        function showMessageModal(message, type = 'info') { // type can be 'info', 'success', 'error'
            modalMessageText.textContent = message;
            messageModalIconContainer.innerHTML = ''; // Clear previous icon

            let iconSvg = '';
            if (type === 'success') {
                iconSvg = '<svg class="w-16 h-16 text-green-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            } else if (type === 'error') {
                iconSvg = '<svg class="w-16 h-16 text-red-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            } else { // Default info icon
                iconSvg = '<svg class="w-16 h-16 text-blue-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            }
            messageModalIconContainer.innerHTML = iconSvg;
            messageModal.classList.add('show');
        }

        function closeMessageModal() {
            messageModal.classList.remove('show');
        }

        function showConfirmationModal(message, onConfirmCallback) {
            confirmationMessageText.textContent = message;
            currentConfirmAction = onConfirmCallback;
            confirmationModal.classList.add('show');
        }

        function closeConfirmationModal() {
            confirmationModal.classList.remove('show');
            currentConfirmAction = null;
        }

        confirmActionButton.addEventListener('click', () => {
            if (typeof currentConfirmAction === 'function') {
                currentConfirmAction();
            }
            closeConfirmationModal();
        });

        cancelActionButton.addEventListener('click', () => {
            closeConfirmationModal();
        });

        function savePets() {
            localStorage.setItem('pets', JSON.stringify(pets));
            renderBookingsList();
            renderPetHistoryList();
        }

        function renderPetsList() {
            petsListContainer.innerHTML = ''; 
            if (pets.length === 0) {
                noPetsMessage.classList.remove('hidden');
                return;
            }
            noPetsMessage.classList.add('hidden');

            pets.forEach(pet => {
                const petCard = document.createElement('div');
                petCard.className = 'card p-5 flex flex-col items-center text-center cursor-pointer group';
                petCard.onclick = () => viewPetDetails(pet.id);

                const petPhotoUrl = pet.photo || `https://placehold.co/150x150/e0e7ff/4f46e5?text=${pet.name.substring(0,1)}`;
                
                petCard.innerHTML = `
                    <img src="${petPhotoUrl}" alt="${pet.name}" class="w-32 h-32 rounded-full object-cover border-4 border-gray-200 group-hover:border-blue-400 transition-all duration-300 mb-4 shadow-lg" onerror="this.onerror=null;this.src='https://placehold.co/150x150/e2e8f0/94a3b8?text=Pet';">
                    <h3 class="text-xl font-semibold text-blue-600 group-hover:text-blue-700">${pet.name}</h3>
                    <p class="text-sm text-gray-500">${pet.breed}</p>
                    ${pet.age ? `<p class="text-xs text-gray-400 mt-1">Age: ${pet.age}</p>` : ''}
                `;
                petsListContainer.appendChild(petCard);
            });
        }

        addPetForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newPet = {
                id: 'pet_' + Date.now(),
                name: addPetForm.petName.value,
                breed: addPetForm.petBreed.value,
                age: addPetForm.petAge.value,
                photo: addPetForm.petPhoto.value,
                needs: [] 
            };
            pets.push(newPet);
            savePets();
            renderPetsList();
            addPetForm.reset();
            showMessageModal(`${newPet.name} has been added successfully!`, 'success');
            showSection('myPets'); 
        });
        
        function populateProviderDropdown() {
            needProviderSelect.innerHTML = '<option value="">None (General Reminder)</option>';
            serviceProviders.forEach(provider => {
                const option = document.createElement('option');
                option.value = provider.id;
                option.textContent = provider.name;
                needProviderSelect.appendChild(option);
            });
        }

        function viewPetDetails(petId) {
            const pet = pets.find(p => p.id === petId);
            if (!pet) {
                showMessageModal('Error: Pet not found.', 'error');
                return;
            }

            currentEditingPetId = pet.id; 
            currentPetIdInput.value = pet.id; 

            detailsPetName.textContent = pet.name;
            detailsPetPhoto.src = pet.photo || `https://placehold.co/400x400/e0e7ff/4f46e5?text=${pet.name}`;
            detailsPetPhoto.onerror = function() { this.src = 'https://placehold.co/400x400/e2e8f0/94a3b8?text=Pet+Photo'; };
            detailsPetBreed.textContent = pet.breed;
            detailsPetAge.textContent = pet.age || 'N/A';
            
            populateProviderDropdown();
            renderPetNeeds(pet.id);
            showSection('petDetailsSection');
        }
        
        function closePetDetails() {
            sections.petDetails.classList.remove('show');
            sections.petDetails.classList.add('hidden');
            currentEditingPetId = null;
        }

        function handleDeletePet() {
            if (!currentEditingPetId) return;
            const pet = pets.find(p => p.id === currentEditingPetId);
            if (!pet) return;

            showConfirmationModal(`Are you sure you want to delete ${pet.name}? This action cannot be undone.`, () => {
                actuallyDeletePet();
            });
        }

        function actuallyDeletePet() {
            if (!currentEditingPetId) return;
            pets = pets.filter(pet => pet.id !== currentEditingPetId);
            savePets();
            renderPetsList();
            closePetDetails();
            showMessageModal('Pet deleted successfully.', 'success');
            showSection('myPets');
        }

        function renderPetNeeds(petId) {
            const pet = pets.find(p => p.id === petId);
            needsList.innerHTML = ''; 

            if (!pet || !pet.needs || pet.needs.length === 0) {
                noNeedsMessage.classList.remove('hidden');
                return;
            }
            noNeedsMessage.classList.add('hidden');

            const sortedNeeds = [...pet.needs].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedNeeds.forEach(need => {
                const needElement = document.createElement('div');
                needElement.className = 'p-3 bg-white rounded-md border border-gray-200 shadow-sm flex justify-between items-center';
                
                const needDate = new Date(need.date);
                const formattedDate = `${needDate.toLocaleDateString()} ${needDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
                let providerName = '';
                let providerIcon = '';
                if (need.providerId) {
                    const provider = serviceProviders.find(p => p.id === need.providerId);
                    if (provider) {
                        providerName = ` <span class="text-xs text-gray-500">(@ ${provider.name})</span>`;
                        providerIcon = provider.icon ? `<span class="mr-2">${provider.icon.replace('w-8 h-8', 'w-5 h-5')}</span>` : '';
                    }
                }
                const isPast = needDate < new Date();

                needElement.innerHTML = `
                    <div class="flex-grow">
                        <p class="font-medium text-indigo-700 flex items-center ${isPast ? 'line-through text-gray-400' : ''}">
                            ${providerIcon || '<svg class="icon-sm text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16v4m-2-2h4m2 13.5V21M16 19h4m0-13.5V5M16 7h4m-9 7a3 3 0 01-6 0 3 3 0 016 0zm12 0a3 3 0 01-6 0 3 3 0 016 0z"></path></svg>'}
                            ${need.description}${providerName}
                        </p>
                        <p class="text-xs text-gray-500 ml-7 ${isPast ? 'line-through' : ''}">${formattedDate} - ${need.status || (isPast ? 'Completed' : 'Pending')}</p>
                    </div>
                    <button onclick="deleteNeed('${pet.id}', '${need.id}')" class="btn btn-danger btn-sm p-1.5 ml-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                `;
                needsList.appendChild(needElement);
            });
        }

        addNeedForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const petId = currentPetIdInput.value; 
            if (!petId) {
                showMessageModal('Error: Could not find pet to add need to.', 'error');
                return;
            }
            const pet = pets.find(p => p.id === petId);
            if (!pet) {
                showMessageModal('Error: Pet not found.', 'error');
                return;
            }
            const newNeed = {
                id: 'need_' + Date.now(),
                description: addNeedForm.needDescription.value,
                date: addNeedForm.needDate.value,
                providerId: addNeedForm.needProvider.value || null,
                status: addNeedForm.needProvider.value ? 'Pending' : 'Scheduled' // Default status
            };
            if (!pet.needs) pet.needs = []; 
            pet.needs.push(newNeed);
            savePets();
            renderPetNeeds(pet.id);
            addNeedForm.reset();
            showMessageModal('Need added successfully!', 'success');
        });

        function deleteNeed(petId, needId) {
            const pet = pets.find(p => p.id === petId);
            if (!pet || !pet.needs) return;
            pet.needs = pet.needs.filter(need => need.id !== needId);
            savePets();
            renderPetNeeds(petId); 
            showMessageModal('Need removed.', 'info');
        }

        function renderProviders() {
            providersListContainer.innerHTML = ''; 
            serviceProviders.forEach(provider => {
                const providerCard = document.createElement('div');
                providerCard.className = 'card p-6 space-y-3 flex flex-col items-center text-center';
                
                let servicesHTML = provider.services.map(service => `<span class="inline-block bg-gray-100 text-gray-600 text-xs font-medium mr-2 mb-2 px-2.5 py-1 rounded-full">${service}</span>`).join('');

                providerCard.innerHTML = `
                    <div class="mb-3 text-gray-400">${provider.icon || '<svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>'}</div>
                    <h3 class="text-xl font-semibold text-green-600">${provider.name}</h3>
                    <p class="text-sm font-medium text-gray-500">${provider.type}</p>
                    <p class="text-sm text-gray-600"><span class="font-medium">Address:</span> ${provider.address || 'N/A'}</p>
                    <div class="mt-2 w-full">
                        <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2 text-left">Services:</h4>
                        <div class="text-left">${servicesHTML || '<p class="text-xs text-gray-500">N/A</p>'}</div>
                    </div>
                    <div class="mt-auto pt-4 space-x-2 border-t border-gray-200 w-full">
                        ${provider.phone ? `<a href="tel:${provider.phone}" class="btn btn-primary text-sm py-1.5 px-3">Call</a>` : ''}
                        ${provider.email ? `<a href="mailto:${provider.email}" class="btn btn-secondary text-sm py-1.5 px-3">Email</a>` : ''}
                    </div>
                `;
                providersListContainer.appendChild(providerCard);
            });
        }

        function renderBookingsList() {
            bookingsListContainer.innerHTML = '';
            let hasBookings = false;
            const now = new Date();
            let upcomingBookings = [];

            pets.forEach(pet => {
                if (pet.needs && pet.needs.length > 0) {
                    pet.needs.forEach(need => {
                        const needDate = new Date(need.date);
                        if (need.providerId && needDate > now) {
                            upcomingBookings.push({ ...need, petName: pet.name, petId: pet.id });
                        }
                    });
                }
            });
            // Sort by date, soonest first
            upcomingBookings.sort((a,b) => new Date(a.date) - new Date(b.date));

            if (upcomingBookings.length > 0) hasBookings = true;

            upcomingBookings.forEach(need => {
                const provider = serviceProviders.find(p => p.id === need.providerId);
                const bookingItem = document.createElement('div');
                bookingItem.className = 'list-item flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2';
                
                const needDate = new Date(need.date);
                const formattedDate = `${needDate.toLocaleDateString()} ${needDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
                const providerIcon = provider && provider.icon ? provider.icon.replace('w-8 h-8', 'w-6 h-6 text-blue-500') : '<svg class="icon-sm text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>';

                bookingItem.innerHTML = `
                    <div class="flex items-center">
                        ${providerIcon}
                        <div>
                            <p class="font-semibold text-blue-700">${need.description} <span class="text-sm text-gray-600 font-normal">for ${need.petName}</span></p>
                            <p class="text-xs text-gray-500">With: ${provider ? provider.name : 'Unknown Provider'}</p>
                            <p class="text-xs text-gray-500">On: ${formattedDate} <span class="font-semibold ${need.status === 'Confirmed' ? 'text-green-600' : 'text-yellow-600'}">(${need.status || 'Pending'})</span></p>
                        </div>
                    </div>
                    <button onclick="viewPetDetails('${need.petId}')" class="btn btn-secondary text-xs py-1 px-3 mt-2 sm:mt-0">View Pet</button>
                `;
                bookingsListContainer.appendChild(bookingItem);
            });
            noBookingsMessage.classList.toggle('hidden', hasBookings);
        }

        function renderPetHistoryList() {
            petHistoryListContainer.innerHTML = '';
            let hasHistory = false;
            const now = new Date();
            let allPastNeeds = [];

            pets.forEach(pet => {
                if (pet.needs && pet.needs.length > 0) {
                    pet.needs.forEach(need => {
                        const needDate = new Date(need.date);
                        if (needDate <= now) {
                            allPastNeeds.push({ ...need, petName: pet.name, petId: pet.id });
                        }
                    });
                }
            });
            allPastNeeds.sort((a, b) => new Date(b.date) - new Date(a.date));
            if (allPastNeeds.length > 0) hasHistory = true;

            allPastNeeds.forEach(need => {
                const provider = serviceProviders.find(p => p.id === need.providerId);
                const historyItem = document.createElement('div');
                historyItem.className = 'list-item flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 opacity-80 hover:opacity-100';
                
                const needDate = new Date(need.date);
                const formattedDate = `${needDate.toLocaleDateString()} ${needDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
                const itemIcon = '<svg class="icon-sm text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>';


                historyItem.innerHTML = `
                     <div class="flex items-center">
                        ${itemIcon}
                        <div>
                            <p class="font-semibold text-gray-700">${need.description} <span class="text-sm text-gray-500 font-normal">for ${need.petName}</span></p>
                            ${provider ? `<p class="text-xs text-gray-500">With: ${provider.name}</p>` : ''}
                            <p class="text-xs text-gray-500">On: ${formattedDate} <span class="font-semibold text-green-700">(${need.status || 'Completed'})</span></p>
                        </div>
                    </div>
                     <button onclick="viewPetDetails('${need.petId}')" class="btn btn-secondary text-xs py-1 px-3 mt-2 sm:mt-0">View Pet</button>
                `;
                petHistoryListContainer.appendChild(historyItem);
            });
            noHistoryMessage.classList.toggle('hidden', hasHistory);
        }

        document.addEventListener('DOMContentLoaded', () => {
            let storedPets = localStorage.getItem('pets');
            if (!storedPets || JSON.parse(storedPets).length === 0) {
                pets = JSON.parse(JSON.stringify(samplePets)); 
                savePets(); 
            } else {
                pets = JSON.parse(storedPets);
            }
            
            showSection('myPets'); 
            renderPetsList();
            renderProviders();
            renderBookingsList(); 
            renderPetHistoryList(); 

            document.addEventListener('keydown', function (event) {
                if (event.key === "Escape") {
                    if (sections.petDetails.classList.contains('show')) closePetDetails();
                    if (messageModal.classList.contains('show')) closeMessageModal();
                    if (confirmationModal.classList.contains('show')) closeConfirmationModal();
                }
            });
        });
    </script>
</body>
</html>
